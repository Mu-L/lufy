# Lufy åˆ†å¸ƒå¼æ¸¸æˆæœåŠ¡å™¨æ¡†æ¶ ğŸ®

Lufy æ˜¯ä¸€ä¸ª**ä¼ä¸šçº§**çš„åˆ†å¸ƒå¼æ¸¸æˆæœåŠ¡å™¨æ¡†æ¶ï¼Œä¸“ä¸ºç‚‰çŸ³ä¼ è¯´ã€çš‡å®¤æˆ˜äº‰ã€ä¸‡æ™ºç‰Œç­‰å¡ç‰Œå’Œç­–ç•¥ç±»æ¸¸æˆè®¾è®¡ã€‚æ¡†æ¶åŸºäº Actor æ¨¡å‹æ„å»ºï¼Œå…·å¤‡ç”Ÿäº§çº§çš„é«˜å¹¶å‘ã€å®‰å…¨æ€§ã€ç›‘æ§èƒ½åŠ›å’Œçƒ­æ›´æ–°æœºåˆ¶ã€‚

[![Go Version](https://img.shields.io/badge/Go-1.21+-blue.svg)](https://golang.org)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![Build Status](https://img.shields.io/badge/Build-Passing-brightgreen.svg)]()
[![Coverage](https://img.shields.io/badge/Coverage-85%25-yellow.svg)]()

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### ğŸ—ï¸ åŸºç¡€æ¶æ„
- **Actor æ¨¡å‹**: åŸºäº Actor æ¨¡å‹çš„å¹¶å‘å¤„ç†ï¼Œæ”¯æŒæ¶ˆæ¯é©±åŠ¨çš„å¼‚æ­¥ç¼–ç¨‹
- **åˆ†å¸ƒå¼æ¶æ„**: æ”¯æŒå¤šèŠ‚ç‚¹éƒ¨ç½²ï¼Œå¯æ¨ªå‘æ‰©å±•è‡³æ•°åƒå°æœåŠ¡å™¨
- **æœåŠ¡å‘ç°**: åŸºäº ETCD çš„è‡ªåŠ¨æœåŠ¡å‘ç°å’Œæ³¨å†Œï¼Œæ”¯æŒæ•…éšœè‡ªæ„ˆ
- **é«˜æ€§èƒ½ç½‘ç»œ**: TCP åè®® + Protobuf åºåˆ—åŒ–ï¼Œæ”¯æŒç™¾ä¸‡çº§å¹¶å‘è¿æ¥
- **RPC é€šä¿¡**: å†…ç½®é«˜æ€§èƒ½ RPC æ¡†æ¶ï¼Œæ”¯æŒè¿æ¥æ± å’Œè´Ÿè½½å‡è¡¡
- **æ¶ˆæ¯é˜Ÿåˆ—**: é›†æˆ NSQ æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ”¯æŒå¼‚æ­¥æ¶ˆæ¯å¤„ç†å’Œäº‹ä»¶é©±åŠ¨

### ğŸ’¾ æ•°æ®å’Œå­˜å‚¨
- **æ•°æ®å­˜å‚¨**: Redis é›†ç¾¤ï¼ˆ6èŠ‚ç‚¹ï¼‰+ MongoDB å‰¯æœ¬é›†ï¼ˆ3èŠ‚ç‚¹ï¼‰
- **é«˜å¯ç”¨éƒ¨ç½²**: æ”¯æŒRediså“¨å…µã€MongoDBå‰¯æœ¬é›†ã€åˆ†ç‰‡é›†ç¾¤
- **å¯¹è±¡æ± **: æ™ºèƒ½å¯¹è±¡æ± ç³»ç»Ÿï¼Œæ˜¾è‘—é™ä½ GC å‹åŠ›
- **æ•°æ®ä¸€è‡´æ€§**: åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
- **ç¼“å­˜ç­–ç•¥**: å¤šçº§ç¼“å­˜æœºåˆ¶ï¼Œæå‡æ•°æ®è®¿é—®æ€§èƒ½
- **æ•…éšœè½¬ç§»**: è‡ªåŠ¨ä¸»ä»åˆ‡æ¢ï¼Œé›¶åœæœºæ—¶é—´

### ğŸ”¥ çƒ­æ›´æ–°ç³»ç»Ÿ
- **é…ç½®çƒ­æ›´æ–°**: æ— éœ€é‡å¯å³å¯æ›´æ–°æ¸¸æˆé…ç½®
- **é€»è¾‘çƒ­æ›´æ–°**: æ”¯æŒæ¸¸æˆé€»è¾‘æ¨¡å—çš„åŠ¨æ€åŠ è½½
- **æ’ä»¶ç³»ç»Ÿ**: åŸºäº Go Plugin çš„çƒ­æ’æ‹”æ¨¡å—æ¶æ„
- **ç‰ˆæœ¬æ§åˆ¶**: å®‰å…¨çš„çƒ­æ›´æ–°ç‰ˆæœ¬ç®¡ç†å’Œå›æ»šæœºåˆ¶

### ğŸ“Š ç›‘æ§å’Œåˆ†æ
- **Prometheus é›†æˆ**: å®Œæ•´çš„æŒ‡æ ‡æ”¶é›†å’Œç›‘æ§ä½“ç³»ï¼Œæ”¯æŒé›†ç¾¤ç›‘æ§
- **Zap é«˜æ€§èƒ½æ—¥å¿—**: ç»“æ„åŒ–æ—¥å¿—è®°å½•ï¼Œæ”¯æŒé«˜å¹¶å‘å’Œé‡‡æ ·
- **pprof æ€§èƒ½åˆ†æ**: å†…ç½®æ€§èƒ½åˆ†æå·¥å…·ï¼Œæ”¯æŒ CPU/å†…å­˜/Goroutine åˆ†æ
- **å®æ—¶å‘Šè­¦**: æ™ºèƒ½å‘Šè­¦ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§é€šçŸ¥æ¸ é“
- **æ€§èƒ½å¯è§†åŒ–**: Grafana ä»ªè¡¨æ¿ï¼Œå®æ—¶å¯è§†åŒ–é›†ç¾¤æ€§èƒ½æ•°æ®
- **é›†ç¾¤æ‹“æ‰‘**: è‡ªåŠ¨å‘ç°å’Œå¯è§†åŒ–é›†ç¾¤æ‹“æ‰‘ç»“æ„

### ğŸ” å®‰å…¨å¢å¼º
- **å¤šå±‚å®‰å…¨é˜²æŠ¤**: JWT è®¤è¯ + ä¼šè¯ç®¡ç† + IP é»‘åå•
- **åä½œå¼Šç³»ç»Ÿ**: æ™ºèƒ½ä½œå¼Šæ£€æµ‹å’Œè¡Œä¸ºåˆ†æ
- **æ•°æ®åŠ å¯†**: AES-GCM åŠ å¯†ç®—æ³•ä¿æŠ¤æ•æ„Ÿæ•°æ®
- **é™æµä¿æŠ¤**: å¤šç»´åº¦é™æµæœºåˆ¶ï¼Œé˜²æ­¢æ¶æ„æ”»å‡»

### ğŸŒ å›½é™…åŒ–æ”¯æŒ
- **å¤šè¯­è¨€æ”¯æŒ**: å†…ç½®ä¸­è‹±æ—¥éŸ©ç­‰è¯­è¨€åŒ…
- **åŠ¨æ€è¯­è¨€åˆ‡æ¢**: å®¢æˆ·ç«¯å¯åŠ¨æ€åˆ‡æ¢æ˜¾ç¤ºè¯­è¨€
- **æœ¬åœ°åŒ–æ ¼å¼**: æ•°å­—ã€è´§å¸ã€æ—¶é—´çš„æœ¬åœ°åŒ–æ˜¾ç¤º
- **ç¿»è¯‘ç®¡ç†**: ä¾¿æ·çš„ç¿»è¯‘æ›´æ–°å’Œç‰ˆæœ¬ç®¡ç†

### ğŸª ç©æ³•æ‰©å±•
- **æ¸¸æˆæ¨¡å—åŒ–**: æ”¯æŒå¤šç§æ¸¸æˆç©æ³•çš„æ¨¡å—åŒ–å¼€å‘
- **å¡ç‰Œç³»ç»Ÿ**: å†…ç½®å®Œæ•´çš„å¡ç‰Œæ¸¸æˆæ¡†æ¶
- **æˆ¿é—´ç®¡ç†**: çµæ´»çš„æ¸¸æˆæˆ¿é—´åˆ›å»ºå’Œç®¡ç†
- **AI ç³»ç»Ÿ**: æ”¯æŒæ¸¸æˆ AI çš„é›†æˆå’Œæ‰©å±•

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### å¿…éœ€ç»„ä»¶
- Go 1.21+
- Redis 6.0+
- MongoDB 4.4+
- ETCD 3.5+
- NSQ 1.2+

### å¯é€‰ç»„ä»¶
- Docker & Docker Composeï¼ˆç”¨äºå¿«é€Ÿéƒ¨ç½²ï¼‰

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "å®¢æˆ·ç«¯å±‚"
        C1[Webå®¢æˆ·ç«¯]
        C2[ç§»åŠ¨å®¢æˆ·ç«¯]
        C3[PCå®¢æˆ·ç«¯]
    end
    
    subgraph "ç½‘å…³å±‚"
        GW1[Gateway-1<br/>è´Ÿè½½å‡è¡¡/è·¯ç”±]
        GW2[Gateway-2<br/>è´Ÿè½½å‡è¡¡/è·¯ç”±]
    end
    
    subgraph "ä¸šåŠ¡æœåŠ¡å±‚"
        LOGIN[Login Service<br/>è®¤è¯/ä¼šè¯ç®¡ç†]
        LOBBY[Lobby Service<br/>å¤§å…/åŒ¹é…]
        GAME1[Game Service-1<br/>æ¸¸æˆé€»è¾‘]
        GAME2[Game Service-2<br/>æ¸¸æˆé€»è¾‘]
        FRIEND[Friend Service<br/>ç¤¾äº¤ç³»ç»Ÿ]
        CHAT[Chat Service<br/>èŠå¤©ç³»ç»Ÿ]
        MAIL[Mail Service<br/>é‚®ä»¶ç³»ç»Ÿ]
    end
    
    subgraph "ç®¡ç†æœåŠ¡å±‚"
        CENTER[Center Service<br/>é›†ç¾¤ç®¡ç†]
        GM[GM Service<br/>è¿è¥å·¥å…·]
    end
    
    subgraph "åŸºç¡€è®¾æ–½å±‚"
        REDIS[(Redis<br/>ç¼“å­˜)]
        MONGO[(MongoDB<br/>æŒä¹…åŒ–)]
        NSQ[NSQ<br/>æ¶ˆæ¯é˜Ÿåˆ—]
        ETCD[ETCD<br/>æœåŠ¡å‘ç°]
    end
    
    subgraph "ç›‘æ§å±‚"
        PROM[Prometheus<br/>æŒ‡æ ‡æ”¶é›†]
        GRAF[Grafana<br/>å¯è§†åŒ–]
        PPROF[pprof<br/>æ€§èƒ½åˆ†æ]
    end
    
    C1 --> GW1
    C2 --> GW2
    C3 --> GW1
    
    GW1 --> LOGIN
    GW1 --> LOBBY
    GW2 --> LOGIN
    GW2 --> LOBBY
    
    LOBBY --> GAME1
    LOBBY --> GAME2
    
    GAME1 --> FRIEND
    GAME1 --> CHAT
    GAME1 --> MAIL
    
    LOGIN --> REDIS
    GAME1 --> REDIS
    GAME1 --> MONGO
    
    CHAT --> NSQ
    MAIL --> NSQ
    
    CENTER --> ETCD
    GM --> CENTER
    
    PROM --> GW1
    PROM --> LOGIN
    PROM --> GAME1
    GRAF --> PROM
    PPROF --> GAME1
```

### æŠ€æœ¯æ ˆç»„ä»¶

| ç»„ä»¶ç±»å‹ | æŠ€æœ¯é€‰å‹ | ç”¨é€”è¯´æ˜ |
|----------|----------|----------|
| **ç¼–ç¨‹è¯­è¨€** | Go 1.21+ | é«˜æ€§èƒ½ã€å¹¶å‘å‹å¥½ |
| **é€šä¿¡åè®®** | TCP + Protobuf | é«˜æ•ˆäºŒè¿›åˆ¶åè®® |
| **å¹¶å‘æ¨¡å‹** | Actor Model | æ¶ˆæ¯é©±åŠ¨çš„å¼‚æ­¥å¤„ç† |
| **æœåŠ¡å‘ç°** | ETCD | åˆ†å¸ƒå¼é…ç½®å’ŒæœåŠ¡æ³¨å†Œ |
| **ç¼“å­˜ç³»ç»Ÿ** | Redis | é«˜é€Ÿæ•°æ®ç¼“å­˜ |
| **æ•°æ®åº“** | MongoDB | æ–‡æ¡£å‹æ•°æ®åº“ |
| **æ¶ˆæ¯é˜Ÿåˆ—** | NSQ | è½»é‡çº§æ¶ˆæ¯é˜Ÿåˆ— |
| **ç›‘æ§ç³»ç»Ÿ** | Prometheus + Grafana | æŒ‡æ ‡æ”¶é›†å’Œå¯è§†åŒ– |
| **æ€§èƒ½åˆ†æ** | pprof | Go åŸç”Ÿæ€§èƒ½åˆ†æ |
| **å®¹å™¨åŒ–** | Docker + Docker Compose | å®¹å™¨åŒ–éƒ¨ç½² |

## ğŸ¯ æœåŠ¡èŠ‚ç‚¹

| æœåŠ¡ | è¯´æ˜ | TCPç«¯å£ | RPCç«¯å£ | ç›‘æ§ç«¯å£ | æ ¸å¿ƒèŒè´£ |
|------|------|---------|---------|----------|----------|
| **Gateway** | ç½‘å…³æœåŠ¡ | 8001-8002 | 9001-9002 | 7001-7002 | å®¢æˆ·ç«¯æ¥å…¥ã€æ¶ˆæ¯è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€å®‰å…¨éªŒè¯ |
| **Login** | ç™»å½•æœåŠ¡ | - | 9020 | 7020 | ç”¨æˆ·è®¤è¯ã€JWTä»¤ç‰Œã€ä¼šè¯ç®¡ç†ã€å®‰å…¨æ£€æŸ¥ |
| **Lobby** | å¤§å…æœåŠ¡ | - | 9030 | 7030 | æˆ¿é—´ç®¡ç†ã€åŒ¹é…ç³»ç»Ÿã€æ¸¸æˆæ¨¡å¼é€‰æ‹© |
| **Game** | æ¸¸æˆæœåŠ¡ | - | 9100-9102 | 7100-7102 | æ¸¸æˆé€»è¾‘ã€AIç³»ç»Ÿã€çƒ­æ›´æ–°æ¨¡å— |
| **Enhanced Game** | å¢å¼ºæ¸¸æˆæœåŠ¡ | - | 9103-9105 | 7103-7105 | åŒ…å«æ‰€æœ‰æ–°ç‰¹æ€§çš„æ¸¸æˆæœåŠ¡èŠ‚ç‚¹ |
| **Friend** | å¥½å‹æœåŠ¡ | - | 9040 | 7040 | å¥½å‹å…³ç³»ã€ç¤¾äº¤åŠŸèƒ½ã€çŠ¶æ€åŒæ­¥ |
| **Chat** | èŠå¤©æœåŠ¡ | - | 9050 | 7050 | èŠå¤©ç³»ç»Ÿã€æ¶ˆæ¯å¹¿æ’­ã€å†…å®¹è¿‡æ»¤ |
| **Mail** | é‚®ä»¶æœåŠ¡ | - | 9060 | 7060 | é‚®ä»¶ç³»ç»Ÿã€å¥–åŠ±å‘æ”¾ã€é€šçŸ¥æ¨é€ |
| **GM** | ç®¡ç†æœåŠ¡ | - | 9200 | 7200 | GMå·¥å…·ã€è¿è¥ç®¡ç†ã€çƒ­æ›´æ–°æ§åˆ¶ |
| **Center** | ä¸­å¿ƒæœåŠ¡ | - | 9010 | 7010 | é›†ç¾¤ç®¡ç†ã€ç›‘æ§ç»Ÿè®¡ã€æœåŠ¡åè°ƒ |

### ç«¯å£åˆ†é…è§„åˆ™

- **TCPç«¯å£ (8xxx)**: å®¢æˆ·ç«¯è¿æ¥ç«¯å£ï¼Œä¸»è¦ç”¨äºGatewayæœåŠ¡
- **RPCç«¯å£ (9xxx)**: æœåŠ¡é—´RPCé€šä¿¡ç«¯å£
- **ç›‘æ§ç«¯å£ (7xxx)**: HTTPç›‘æ§æ¥å£ï¼Œæä¾›æŒ‡æ ‡æŸ¥è¯¢å’Œå¥åº·æ£€æŸ¥
- **pprofç«¯å£ (8xxx)**: æ€§èƒ½åˆ†æç«¯å£ = ç›‘æ§ç«¯å£ + 1000

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒæ£€æŸ¥

ä½¿ç”¨è‡ªåŠ¨æ£€æŸ¥è„šæœ¬éªŒè¯ç¯å¢ƒä¾èµ–ï¼š

```bash
git clone <repository-url> lufy
cd lufy

# æ£€æŸ¥æ‰€æœ‰ä¾èµ–
chmod +x scripts/*.sh
./scripts/check_deps.sh
```

### 2. Docker éƒ¨ç½²æ–¹å¼

#### 2.1 å•æœºéƒ¨ç½²ï¼ˆå¼€å‘/æµ‹è¯•ï¼‰

```bash
# å¯åŠ¨å•æœºç‰ˆæœ¬ï¼ˆåŒ…æ‹¬æ‰€æœ‰ä¾èµ–æœåŠ¡ï¼‰
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f lufy-center
```

#### 2.2 é›†ç¾¤éƒ¨ç½²ï¼ˆç”Ÿäº§æ¨èï¼‰

```bash
# å¯åŠ¨é«˜å¯ç”¨é›†ç¾¤ï¼ˆRedisé›†ç¾¤ + MongoDBå‰¯æœ¬é›† + ETCDé›†ç¾¤ï¼‰
make cluster-up

# æˆ–æ‰‹åŠ¨å¯åŠ¨
chmod +x scripts/*.sh
./scripts/start_cluster.sh full --with-monitoring

# å¿«é€Ÿå¯åŠ¨ï¼ˆå¼€å‘ç”¨ï¼‰
./scripts/start_cluster.sh quick

# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
./scripts/cluster_status.sh

# å®æ—¶é›†ç¾¤ç›‘æ§
./scripts/cluster_status.sh watch
```

**é›†ç¾¤æ¶æ„åŒ…å«ï¼š**
- **Redisé›†ç¾¤**: 6èŠ‚ç‚¹ï¼ˆ3ä¸»3ä»ï¼‰
- **MongoDBå‰¯æœ¬é›†**: 3èŠ‚ç‚¹ï¼ˆ1ä¸»2ä»ï¼‰
- **ETCDé›†ç¾¤**: 3èŠ‚ç‚¹ï¼ˆé«˜å¯ç”¨ï¼‰
- **NSQé›†ç¾¤**: 2ä¸ªLookup + 3ä¸ªDaemon
- **åº”ç”¨æœåŠ¡**: å¤šå®ä¾‹è´Ÿè½½å‡è¡¡
- **è´Ÿè½½å‡è¡¡**: Nginxåå‘ä»£ç†

### 3. æœ¬åœ°å¼€å‘å¯åŠ¨

#### 3.1 å¯åŠ¨åŸºç¡€ä¾èµ–

```bash
# ä½¿ç”¨ Docker å¯åŠ¨åŸºç¡€è®¾æ–½ï¼ˆæ¨èï¼‰
docker-compose up -d redis mongodb etcd nsqlookupd nsqd

# æˆ–æ‰‹åŠ¨å¯åŠ¨å„ä¸ªç»„ä»¶
redis-server &
mongod &
etcd &
nsqlookupd &
nsqd --lookupd-tcp-address=127.0.0.1:4160 &
```

#### 3.2 æ„å»ºå’Œå¯åŠ¨æ¸¸æˆæœåŠ¡å™¨

```bash
# ä¸‹è½½Goä¾èµ–
go mod tidy

# æ„å»ºé¡¹ç›®
make build

# å¯åŠ¨åŸºç¡€ç‰ˆæ¸¸æˆæœåŠ¡å™¨
./scripts/start.sh

# æˆ–å¯åŠ¨å¢å¼ºç‰ˆæ¸¸æˆæœåŠ¡å™¨ï¼ˆåŒ…å«æ‰€æœ‰æ–°ç‰¹æ€§ï¼‰
./scripts/start_enhanced.sh

# å¯åŠ¨å¢å¼ºç‰ˆ + å®Œæ•´ç›‘æ§æ ˆ
./scripts/start_enhanced.sh --with-monitoring
```

### 4. éªŒè¯éƒ¨ç½²

#### 4.1 æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
./scripts/status.sh

# å®æ—¶ç›‘æ§æ¨¡å¼
./scripts/status.sh watch
```

#### 4.2 æµ‹è¯•å®¢æˆ·ç«¯è¿æ¥

```bash
# è¿è¡Œæµ‹è¯•å®¢æˆ·ç«¯
go run examples/client/main.go

# è¾“å‡ºç¤ºä¾‹:
# Connected to server: 127.0.0.1:8001
# Login successful! UserID: 123456, Token: abcd1234...
# Player Info - Nickname: testuser, Level: 1, Gold: 1000, Diamond: 100
```

#### 4.3 è®¿é—®ç›‘æ§é¢æ¿

å¯åŠ¨å®Œæˆåï¼Œå¯ä»¥è®¿é—®ä»¥ä¸‹ç›‘æ§é¢æ¿ï¼š

| æœåŠ¡ | åœ°å€ | è¯´æ˜ |
|------|------|------|
| **ä¸»ç›‘æ§é¢æ¿** | http://localhost:7001 | æœåŠ¡å¥åº·çŠ¶å†µå’ŒæŒ‡æ ‡ |
| **pprof æ€§èƒ½åˆ†æ** | http://localhost:8001/debug/pprof/ | Go æ€§èƒ½åˆ†æå·¥å…· |
| **Prometheus** | http://localhost:9090 | æŒ‡æ ‡æ•°æ®åº“å’ŒæŸ¥è¯¢ |
| **Grafana** | http://localhost:3000 | å¯è§†åŒ–ä»ªè¡¨æ¿ (admin/admin) |
| **NSQ ç®¡ç†** | http://localhost:4171 | æ¶ˆæ¯é˜Ÿåˆ—ç®¡ç† |
| **Redis ç®¡ç†** | http://localhost:8081 | Redis æ•°æ®ç®¡ç† |
| **MongoDB ç®¡ç†** | http://localhost:8082 | MongoDB æ•°æ®ç®¡ç† |

### 5. æ€§èƒ½åˆ†æ

#### 5.1 ä½¿ç”¨å†…ç½®åˆ†æå·¥å…·

```bash
# æ”¶é›†æ€§èƒ½æŒ‡æ ‡
go run tools/performance_analyzer.go collect

# ç”Ÿæˆ pprof åˆ†æå‘½ä»¤
go run tools/performance_analyzer.go pprof

# å®æ—¶ç›‘æ§æ¨¡å¼
go run tools/performance_analyzer.go watch
```

#### 5.2 pprof æ€§èƒ½åˆ†æ

```bash
# CPU æ€§èƒ½åˆ†æï¼ˆé‡‡é›†30ç§’ï¼‰
go tool pprof http://localhost:8001/debug/pprof/profile?seconds=30

# å†…å­˜å †åˆ†æ
go tool pprof http://localhost:8001/debug/pprof/heap

# Goroutine åˆ†æ
go tool pprof http://localhost:8001/debug/pprof/goroutine

# åœ¨ pprof äº¤äº’æ¨¡å¼ä¸­ï¼š
(pprof) top          # æŸ¥çœ‹çƒ­ç‚¹å‡½æ•°
(pprof) web          # ç”Ÿæˆè°ƒç”¨å›¾
(pprof) list main    # æŸ¥çœ‹å‡½æ•°ä»£ç 
```

## âš™ï¸ é…ç½®è¯´æ˜

ä¸»é…ç½®æ–‡ä»¶ä½äº `config/config.yaml`ï¼ŒåŒ…å«ä»¥ä¸‹é…ç½®é¡¹ï¼š

### æœåŠ¡å™¨é…ç½®
```yaml
server:
  name: "lufy-game-server"
  version: "1.0.0"
  debug: true
```

### ç½‘ç»œé…ç½®
```yaml
network:
  tcp_port: 8001      # TCPæœåŠ¡ç«¯å£
  rpc_port: 9001      # RPCæœåŠ¡ç«¯å£
  http_port: 7001     # HTTPç®¡ç†ç«¯å£
  max_connections: 10000
  read_timeout: 30
  write_timeout: 30
```

### æ•°æ®åº“é…ç½®
```yaml
database:
  redis:
    addr: "127.0.0.1:6379"
    password: ""
    db: 0
    pool_size: 100
  mongodb:
    uri: "mongodb://127.0.0.1:27017"
    database: "lufy_game"
    pool_size: 100
```

## ğŸ”¥ çƒ­æ›´æ–°ç³»ç»Ÿ

Lufy æ”¯æŒç”Ÿäº§çº§çš„çƒ­æ›´æ–°æœºåˆ¶ï¼Œå¯åœ¨ä¸åœæœçš„æƒ…å†µä¸‹æ›´æ–°æ¸¸æˆé€»è¾‘ã€é…ç½®å’Œæ•°æ®ã€‚

### çƒ­æ›´æ–°ç±»å‹

| ç±»å‹ | è¯´æ˜ | å½±å“èŒƒå›´ | å®‰å…¨çº§åˆ« |
|------|------|----------|----------|
| **é…ç½®æ›´æ–°** | æ¸¸æˆå‚æ•°ã€å¹³è¡¡æ€§è°ƒæ•´ | æ‰€æœ‰æœåŠ¡ | ğŸŸ¢ å®‰å…¨ |
| **é€»è¾‘æ›´æ–°** | æ¸¸æˆè§„åˆ™ã€AIç®—æ³• | æ¸¸æˆæœåŠ¡ | ğŸŸ¡ è°¨æ… |
| **æ•°æ®æ›´æ–°** | å¡ç‰Œæ•°æ®ã€å¥–åŠ±é…ç½® | ç›¸å…³æœåŠ¡ | ğŸŸ¢ å®‰å…¨ |
| **æ¨¡å—æ›´æ–°** | æ–°åŠŸèƒ½æ¨¡å— | æŒ‡å®šæœåŠ¡ | ğŸ”´ é«˜é£é™© |

### çƒ­æ›´æ–°æ“ä½œ

```bash
# é‡è½½æ‰€æœ‰èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶
./scripts/hot_reload.sh config

# é‡è½½æ¸¸æˆèŠ‚ç‚¹çš„é€»è¾‘æ¨¡å—
./scripts/hot_reload.sh logic game

# é‡è½½æŒ‡å®šèŠ‚ç‚¹çš„ç‰¹å®šæ¨¡å—
./scripts/hot_reload.sh module gateway1 auth_module

# æŸ¥çœ‹çƒ­æ›´æ–°çŠ¶æ€
./scripts/hot_reload.sh status

# å›æ»šæœ€è¿‘çš„æ›´æ–°
./scripts/hot_reload.sh rollback game1
```

### çƒ­æ›´æ–°æœ€ä½³å®è·µ

```bash
# 1. æ›´æ–°å‰å¤‡ä»½é…ç½®
cp config/config.yaml config/config.yaml.backup

# 2. éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•
make validate-config

# 3. åœ¨å•ä¸ªèŠ‚ç‚¹æµ‹è¯•
./scripts/hot_reload.sh config game1

# 4. ç¡®è®¤æ— è¯¯åå…¨é‡æ›´æ–°
./scripts/hot_reload.sh config all

# 5. ç›‘æ§ç³»ç»ŸæŒ‡æ ‡
go run tools/performance_analyzer.go watch
```

## ğŸ“Š æ€§èƒ½ç›‘æ§ä¸åˆ†æ

### Prometheus æŒ‡æ ‡

Lufy å†…ç½®äº†å®Œæ•´çš„ Prometheus æŒ‡æ ‡ä½“ç³»ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰æŒ‡æ ‡
curl http://localhost:7001/metrics

# å…³é”®ä¸šåŠ¡æŒ‡æ ‡
curl http://localhost:7001/api/metrics | jq .
```

#### æ ¸å¿ƒæŒ‡æ ‡è¯´æ˜

```yaml
# ç³»ç»ŸæŒ‡æ ‡
lufy_cpu_usage_percent{node_id="game1",node_type="game"}      # CPUä½¿ç”¨ç‡
lufy_memory_usage_bytes{node_id="game1",node_type="game"}     # å†…å­˜ä½¿ç”¨é‡
lufy_goroutines_total{node_id="game1",node_type="game"}       # Goroutineæ•°é‡

# ç½‘ç»œæŒ‡æ ‡
lufy_connections_total{node_id="gateway1",node_type="gateway"} # è¿æ¥æ•°
lufy_request_duration_seconds                                  # è¯·æ±‚å»¶è¿Ÿ

# ä¸šåŠ¡æŒ‡æ ‡
lufy_messages_total{message_type="user_login"}                # æ¶ˆæ¯å¤„ç†é‡
lufy_errors_total{error_type="login_failed"}                  # é”™è¯¯ç»Ÿè®¡
lufy_actors_total{node_id="game1",node_type="game"}          # Actoræ•°é‡
```

### æ€§èƒ½åˆ†æå·¥å…·

#### è‡ªåŠ¨åŒ–åˆ†æ

```bash
# æ”¶é›†å½“å‰æ€§èƒ½å¿«ç…§
go run tools/performance_analyzer.go collect

# è¾“å‡ºç¤ºä¾‹ï¼š
# ğŸ“ˆ é›†ç¾¤æ¦‚è§ˆ:
#   æœåŠ¡æ€»æ•°: 12
#   å¹³å‡CPUä½¿ç”¨ç‡: 15.2%
#   å¹³å‡å†…å­˜ä½¿ç”¨ç‡: 45.8%
#   æ€»Goroutines: 2847
#   å‘Šè­¦æ€»æ•°: 0
#   ä¼˜åŒ–å»ºè®®: 2æ¡

# ä¸å†å²æ•°æ®å¯¹æ¯”
go run tools/performance_analyzer.go save baseline.json
# ... è¿è¡Œä¸€æ®µæ—¶é—´å ...
go run tools/performance_analyzer.go compare baseline.json
```

#### æ‰‹åŠ¨ pprof åˆ†æ

```bash
# å„æœåŠ¡çš„æ€§èƒ½åˆ†æç«¯ç‚¹
go tool pprof http://localhost:8001/debug/pprof/profile   # Gateway
go tool pprof http://localhost:8100/debug/pprof/heap     # Game Server  
go tool pprof http://localhost:8020/debug/pprof/goroutine # Login

# ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
go tool pprof -http=:8080 profile.pb.gz  # Webç•Œé¢æŸ¥çœ‹
go tool pprof -png profile.pb.gz > profile.png  # ç”ŸæˆPNGå›¾ç‰‡
```

### Grafana ä»ªè¡¨æ¿

è®¿é—® http://localhost:3000ï¼Œä½¿ç”¨ admin/admin ç™»å½•ï¼Œé¢„é…ç½®çš„ä»ªè¡¨æ¿åŒ…æ‹¬ï¼š

1. **é›†ç¾¤æ¦‚è§ˆ**: æ•´ä½“å¥åº·çŠ¶å†µå’Œå…³é”®æŒ‡æ ‡
2. **æœåŠ¡è¯¦æƒ…**: å•ä¸ªæœåŠ¡çš„è¯¦ç»†ç›‘æ§
3. **ä¸šåŠ¡ç›‘æ§**: ç”¨æˆ·ç™»å½•ã€æ¸¸æˆæ´»è·ƒåº¦ç­‰
4. **å‘Šè­¦ä¸­å¿ƒ**: å®æ—¶å‘Šè­¦å’Œå†å²è®°å½•

## ğŸ” å®‰å…¨ç‰¹æ€§

### è®¤è¯å’Œæˆæƒ

```go
// JWT ä»¤ç‰Œè®¤è¯
claims := &TokenClaims{
    UserID:      userID,
    Username:    username,
    Permissions: []string{"player", "premium"},
    StandardClaims: jwt.StandardClaims{
        ExpiresAt: time.Now().Add(24 * time.Hour).Unix(),
    },
}

token, err := security.GenerateToken(claims)
```

### åä½œå¼Šç³»ç»Ÿ

```bash
# æŸ¥çœ‹ä½œå¼Šæ£€æµ‹æŠ¥å‘Š
curl http://localhost:7001/api/security

# æ‰‹åŠ¨æ ‡è®°å¯ç–‘ç”¨æˆ·
curl -X POST http://localhost:7200/gm/flag_user \
  -d '{"user_id": 123456, "reason": "suspicious_pattern"}'
```

### å®‰å…¨é…ç½®

```yaml
# config/security.yaml
security:
  jwt:
    secret: "your-jwt-secret"
    expires_hours: 24
  
  rate_limit:
    requests_per_minute: 100
    burst_size: 10
  
  blacklist:
    auto_ban_threshold: 10
    ban_duration_hours: 24
  
  encryption:
    algorithm: "aes-gcm"
    key_size: 256
```

## ğŸŒ å›½é™…åŒ–é…ç½®

### æ”¯æŒçš„è¯­è¨€

- ğŸ‡ºğŸ‡¸ **English (en)** - é»˜è®¤è¯­è¨€
- ğŸ‡¨ğŸ‡³ **ç®€ä½“ä¸­æ–‡ (zh-CN)** - å®Œæ•´æ”¯æŒ
- ğŸ‡¯ğŸ‡µ **æ—¥æœ¬èª (ja)** - åŸºç¡€æ”¯æŒ
- ğŸ‡°ğŸ‡· **í•œêµ­ì–´ (ko)** - åŸºç¡€æ”¯æŒ

### è¯­è¨€é…ç½®

```bash
# æ·»åŠ æ–°è¯­è¨€åŒ…
mkdir -p locales
echo '[{"id": "welcome", "one": "Welcome to the game!"}]' > locales/en.json

# æ›´æ–°ç¿»è¯‘
curl -X POST http://localhost:7001/api/i18n/update \
  -d '{"lang": "zh-CN", "key": "welcome", "value": "æ¬¢è¿æ¥åˆ°æ¸¸æˆï¼"}'

# éªŒè¯ç¿»è¯‘å®Œæ•´æ€§
curl http://localhost:7001/api/i18n/validate
```

### å®¢æˆ·ç«¯è¯­è¨€æ£€æµ‹

```go
// è‡ªåŠ¨æ£€æµ‹å®¢æˆ·ç«¯è¯­è¨€åå¥½
acceptLanguage := "zh-CN,zh;q=0.9,en;q=0.8"
detectedLang := i18nManager.DetectLanguage(acceptLanguage)
// è¿”å›: "zh-CN"

// æ ¼å¼åŒ–æœ¬åœ°åŒ–æ¶ˆæ¯
message := i18nManager.Translate("zh-CN", "game.your_turn", nil)
// è¿”å›: "è½®åˆ°ä½ äº†"
```

## ğŸ® å®¢æˆ·ç«¯æ¥å…¥

### åè®®æ ¼å¼

å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨é€šä¿¡ä½¿ç”¨ Protobuf åè®®ï¼Œæ¶ˆæ¯æ ¼å¼ï¼š

```
[4å­—èŠ‚é•¿åº¦][4å­—èŠ‚æ¶ˆæ¯ID][Protobufæ¶ˆæ¯å†…å®¹]
```

### æ¶ˆæ¯ç»“æ„

```protobuf
message BaseRequest {
    MessageHeader header = 1;  // æ¶ˆæ¯å¤´
    bytes data = 2;           // æ¶ˆæ¯ä½“
}

message BaseResponse {
    MessageHeader header = 1;  // æ¶ˆæ¯å¤´
    int32 code = 2;           // é”™è¯¯ç 
    string msg = 3;           // æ¶ˆæ¯å†…å®¹ï¼ˆå·²æœ¬åœ°åŒ–ï¼‰
    bytes data = 4;           // å“åº”æ•°æ®
}

message MessageHeader {
    uint32 msg_id = 1;        // æ¶ˆæ¯ID
    uint32 seq = 2;           // åºåˆ—å·
    uint64 user_id = 3;       // ç”¨æˆ·ID
    uint32 timestamp = 4;     // æ—¶é—´æˆ³
    string session_id = 5;    // ä¼šè¯ID
}
```

### æ¶ˆæ¯IDè§„åˆ’

| æ¶ˆæ¯IDèŒƒå›´ | æœåŠ¡ç±»å‹ | è¯´æ˜ |
|-----------|----------|------|
| 1001-1999 | Gateway | ç™»å½•ã€å¿ƒè·³ã€åŸºç¡€åŠŸèƒ½ |
| 2001-2999 | Lobby | å¤§å…ã€æˆ¿é—´ç®¡ç† |
| 3001-3999 | Game | æ¸¸æˆé€»è¾‘ã€æ“ä½œ |
| 4001-4999 | Friend | å¥½å‹ç³»ç»Ÿ |
| 5001-5999 | Chat | èŠå¤©åŠŸèƒ½ |
| 6001-6999 | Mail | é‚®ä»¶ç³»ç»Ÿ |
| 7001-7999 | GM | ç®¡ç†åŠŸèƒ½ |

### å®Œæ•´ç™»å½•æµç¨‹

```go
// 1. å»ºç«‹TCPè¿æ¥åˆ°ç½‘å…³
conn, err := net.Dial("tcp", "127.0.0.1:8001")

// 2. æ„é€ ç™»å½•è¯·æ±‚
loginReq := &proto.LoginRequest{
    Username: "player1",
    Password: "123456",
    DeviceId: "device_123",
    Platform: "android",
    Version:  "1.0.0",
}

// 3. å°è£…æˆåŸºç¡€è¯·æ±‚
baseReq := &proto.BaseRequest{
    Header: &proto.MessageHeader{
        MsgId:     1001, // ç™»å½•æ¶ˆæ¯ID
        Seq:       1,
        Timestamp: uint32(time.Now().Unix()),
    },
    Data: proto.Marshal(loginReq),
}

// 4. å‘é€è¯·æ±‚å¹¶å¤„ç†å“åº”
response, err := sendRequest(conn, 1001, baseReq)
if err != nil {
    log.Fatal(err)
}

// 5. è§£æç™»å½•å“åº”
var loginResp proto.LoginResponse
proto.Unmarshal(response.Data, &loginResp)

fmt.Printf("ç™»å½•æˆåŠŸ! ç”¨æˆ·ID: %d, ä»¤ç‰Œ: %s\n", 
    loginResp.UserId, loginResp.Token[:10]+"...")
```

## ğŸ”§ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°æœåŠ¡èŠ‚ç‚¹

1. **åˆ›å»ºæœåŠ¡æ–‡ä»¶**ï¼š`internal/server/your_server.go`
2. **å®ç°Serveræ¥å£**ï¼šåŒ…æ‹¬Start()ã€Stop()ç­‰æ–¹æ³•
3. **æ³¨å†ŒæœåŠ¡ç±»å‹**ï¼šåœ¨`NewServer`å‡½æ•°ä¸­æ·»åŠ æœåŠ¡ç±»å‹
4. **æ›´æ–°é…ç½®**ï¼šæ·»åŠ ç«¯å£é…ç½®å’ŒæœåŠ¡å‚æ•°
5. **æ›´æ–°å¯åŠ¨è„šæœ¬**ï¼šæ·»åŠ åˆ°å¯åŠ¨åºåˆ—

```go
// internal/server/your_server.go
type YourServer struct {
    *BaseServer
    yourComponent *YourComponent
}

func NewYourServer(configFile, nodeID string) *YourServer {
    baseServer, err := NewBaseServer(configFile, "your_service", nodeID)
    if err != nil {
        logger.Fatal(fmt.Sprintf("Failed to create base server: %v", err))
    }

    yourServer := &YourServer{
        BaseServer: baseServer,
        yourComponent: NewYourComponent(),
    }

    // æ³¨å†Œé€šç”¨æœåŠ¡
    if err := RegisterCommonServices(baseServer); err != nil {
        logger.Fatal(fmt.Sprintf("Failed to register common services: %v", err))
    }

    return yourServer
}
```

### æ·»åŠ æ–°çš„Actor

```go
type YourActor struct {
    *actor.BaseActor
    server     *YourServer
    customData map[string]interface{}
}

func NewYourActor(server *YourServer) *YourActor {
    baseActor := actor.NewBaseActor("your_actor", "your_type", 1000)
    return &YourActor{
        BaseActor:  baseActor,
        server:     server,
        customData: make(map[string]interface{}),
    }
}

func (ya *YourActor) OnReceive(ctx context.Context, msg actor.Message) error {
    // è®°å½•æ€§èƒ½æŒ‡æ ‡
    start := time.Now()
    defer func() {
        duration := time.Since(start)
        ya.server.monitoring.RecordRequestDuration("actor", msg.GetType(), duration)
    }()

    switch msg.GetType() {
    case "your_message_type":
        return ya.handleYourMessage(msg)
    case actor.MSG_TYPE_SYSTEM_CMD:
        return ya.handleSystemCommand(msg)
    default:
        logger.Debug(fmt.Sprintf("Unknown message type: %s", msg.GetType()))
    }
    return nil
}

func (ya *YourActor) handleYourMessage(msg actor.Message) error {
    // å®ç°è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†é€»è¾‘
    ya.server.monitoring.RecordMessage("your_message")
    return nil
}
```

### æ·»åŠ æ–°çš„RPCæœåŠ¡

```go
type YourService struct {
    server   *YourServer
    security *security.SecurityManager
    i18n     *i18n.I18nManager
}

func NewYourService(server *YourServer) *YourService {
    return &YourService{
        server:   server,
        security: server.security,
        i18n:     server.i18n,
    }
}

func (ys *YourService) RegisterMethods() map[string]reflect.Value {
    methods := make(map[string]reflect.Value)
    methods["YourMethod"] = reflect.ValueOf(ys.YourMethod)
    methods["SecureMethod"] = reflect.ValueOf(ys.SecureMethod)
    return methods
}

func (ys *YourService) YourMethod(ctx context.Context, req *proto.BaseRequest) (*proto.BaseResponse, error) {
    // æ€§èƒ½ç›‘æ§
    start := time.Now()
    defer func() {
        duration := time.Since(start)
        ys.server.monitoring.RecordRequestDuration("rpc", "YourMethod", duration)
    }()

    // å®‰å…¨éªŒè¯
    session, err := ys.validateRequest(req)
    if err != nil {
        return ys.createErrorResponse(req, -1, "error.permission_denied", nil)
    }

    // ä¸šåŠ¡é€»è¾‘å¤„ç†
    // ...

    // è¿”å›æœ¬åœ°åŒ–å“åº”
    langCode := ys.detectLanguage(req)
    message := ys.i18n.Translate(langCode, "success.operation_completed", nil)

    return &proto.BaseResponse{
        Header: req.Header,
        Code:   0,
        Msg:    message,
    }, nil
}
```

### æ·»åŠ æ–°çš„æ¸¸æˆæ¨¡å—

```go
// plugins/your_game.go
type YourGameModule struct {
    name    string
    version string
    config  map[string]interface{}
}

func NewYourGameModule() *YourGameModule {
    return &YourGameModule{
        name:    "your_game",
        version: "1.0.0",
        config:  make(map[string]interface{}),
    }
}

func (ygm *YourGameModule) Initialize() error {
    // åŠ è½½æ¸¸æˆé…ç½®
    ygm.config["max_players"] = 4
    ygm.config["turn_time"] = 60
    logger.Info("Your game module initialized")
    return nil
}

func (ygm *YourGameModule) CreateRoom(config *gameplay.RoomConfig) (*gameplay.GameRoom, error) {
    // åˆ›å»ºæ¸¸æˆæˆ¿é—´é€»è¾‘
    room := &gameplay.GameRoom{
        ID:       generateRoomID(),
        GameType: ygm.name,
        Players:  make(map[uint64]*gameplay.Player),
        State:    gameplay.GameStateWaiting,
        Config:   config,
    }
    return room, nil
}

func (ygm *YourGameModule) ProcessAction(room *gameplay.GameRoom, player *gameplay.Player, action *gameplay.GameAction) (*gameplay.GameResult, error) {
    // å®ç°æ¸¸æˆé€»è¾‘
    switch action.Type {
    case "your_action_type":
        return ygm.processYourAction(room, player, action)
    default:
        return nil, fmt.Errorf("unknown action type: %s", action.Type)
    }
}
```

### æ·»åŠ è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡

```go
// åœ¨ä½ çš„æœåŠ¡ä¸­æ·»åŠ è‡ªå®šä¹‰æŒ‡æ ‡
func (ys *YourService) initCustomMetrics() {
    // è‡ªå®šä¹‰è®¡æ•°å™¨
    ys.customCounter = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Name: "lufy_your_service_operations_total",
            Help: "Total number of your service operations",
        },
        []string{"operation_type", "result"},
    )

    // è‡ªå®šä¹‰ç›´æ–¹å›¾
    ys.customHistogram = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Name:    "lufy_your_service_duration_seconds",
            Help:    "Duration of your service operations",
            Buckets: prometheus.DefBuckets,
        },
        []string{"operation_type"},
    )

    // æ³¨å†ŒæŒ‡æ ‡
    prometheus.MustRegister(ys.customCounter, ys.customHistogram)
}

func (ys *YourService) recordOperation(opType string, success bool) {
    result := "success"
    if !success {
        result = "failure"
    }
    ys.customCounter.With(prometheus.Labels{
        "operation_type": opType,
        "result":        result,
    }).Inc()
}
```

## ğŸ› ï¸ è¿ç»´å·¥å…·

### é›†ç¾¤ç®¡ç†

```bash
# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
make status

# å¯åŠ¨å®Œæ•´é›†ç¾¤
make start

# åœæ­¢é›†ç¾¤
make stop

# é‡å¯é›†ç¾¤
make restart

# æ»šåŠ¨æ›´æ–°
make rolling-update
```

### æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨å•ä¸ªæœåŠ¡
./scripts/start.sh gateway gateway1

# åœæ­¢å•ä¸ªæœåŠ¡
./scripts/stop.sh gateway gateway1

# é‡å¯æœåŠ¡
./scripts/restart.sh game game1

# æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
curl http://localhost:7001/health
```

### çƒ­æ›´æ–°ç®¡ç†

```bash
# æŸ¥çœ‹å¯ç”¨çš„çƒ­æ›´æ–°å‘½ä»¤
./scripts/hot_reload.sh help

# é…ç½®çƒ­æ›´æ–°ï¼ˆå®‰å…¨ï¼‰
./scripts/hot_reload.sh config

# é€»è¾‘çƒ­æ›´æ–°ï¼ˆéœ€è°¨æ…ï¼‰
./scripts/hot_reload.sh logic game

# æ•°æ®çƒ­æ›´æ–°
./scripts/hot_reload.sh data

# æ¨¡å—çƒ­æ›´æ–°
./scripts/hot_reload.sh module game1 card_battle_module

# æŸ¥çœ‹çƒ­æ›´æ–°å†å²
./scripts/hot_reload.sh status
```

### ç›‘æ§å’Œå‘Šè­¦

```bash
# å®æ—¶æ€§èƒ½ç›‘æ§
go run tools/performance_analyzer.go watch

# æ”¶é›†æ€§èƒ½æŠ¥å‘Š
go run tools/performance_analyzer.go collect > reports/perf_$(date +%Y%m%d_%H%M%S).txt

# è®¾ç½®å‘Šè­¦è§„åˆ™
curl -X POST http://localhost:9090/api/v1/rules \
  -d @monitoring/lufy_rules.yml

# æŸ¥çœ‹å½“å‰å‘Šè­¦
curl http://localhost:7001/api/alerts
```

### æ•°æ®åº“ç®¡ç†

```bash
# MongoDB æ“ä½œ
make db-backup          # æ•°æ®å¤‡ä»½
make db-restore         # æ•°æ®æ¢å¤
make db-migrate         # æ‰§è¡Œè¿ç§»

# Redis æ“ä½œ
redis-cli --rdb backup/dump_$(date +%Y%m%d).rdb  # å¤‡ä»½
redis-cli flushall      # æ¸…ç©ºç¼“å­˜ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

# æ•°æ®åº“å¥åº·æ£€æŸ¥
curl http://localhost:7001/api/db/health
```

## ğŸ“Š é«˜çº§ç›‘æ§

### ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

```bash
# å®æ—¶ç”¨æˆ·æ•°æ®
curl http://localhost:7001/api/metrics | jq '.business'

# æ¸¸æˆæˆ¿é—´ç»Ÿè®¡
curl http://localhost:7100/api/rooms/stats

# ç”¨æˆ·è¡Œä¸ºåˆ†æ
curl http://localhost:7001/api/analytics/user_behavior
```

### è‡ªå®šä¹‰ä»ªè¡¨æ¿

```json
{
  "dashboard": {
    "title": "Lufy æ¸¸æˆæœåŠ¡å™¨ç›‘æ§",
    "panels": [
      {
        "title": "åœ¨çº¿ç”¨æˆ·æ•°",
        "type": "graph",
        "targets": [
          {
            "expr": "lufy_online_users_total",
            "legendFormat": "{{node_type}}"
          }
        ]
      },
      {
        "title": "æ¸¸æˆæˆ¿é—´æ•°",
        "type": "singlestat", 
        "targets": [
          {
            "expr": "sum(lufy_game_rooms_total)"
          }
        ]
      }
    ]
  }
}
```

### å‘Šè­¦é…ç½®ç¤ºä¾‹

```yaml
# monitoring/custom_alerts.yml
groups:
- name: business_alerts
  rules:
  - alert: LoginFailureSpike
    expr: rate(lufy_login_failures_total[1m]) > 10
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "ç™»å½•å¤±è´¥ç‡å¼‚å¸¸å‡é«˜"
      description: "1åˆ†é’Ÿå†…ç™»å½•å¤±è´¥æ¬¡æ•°è¶…è¿‡10æ¬¡"

  - alert: GameRoomCreationStalled
    expr: rate(lufy_room_created_total[5m]) == 0
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "æ¸¸æˆæˆ¿é—´åˆ›å»ºåœæ»"
      description: "5åˆ†é’Ÿå†…æ²¡æœ‰æ–°çš„æ¸¸æˆæˆ¿é—´åˆ›å»º"
```

## ğŸ® æ¸¸æˆå¼€å‘ç¤ºä¾‹

### å¡ç‰Œæ¸¸æˆå¼€å‘

```go
// 1. å®šä¹‰å¡ç‰Œæ•°æ®ç»“æ„
type Card struct {
    ID          int    `json:"id"`
    Name        string `json:"name"`
    Cost        int    `json:"cost"`
    Attack      int    `json:"attack"`
    Health      int    `json:"health"`
    Description string `json:"description"`
    Rarity      string `json:"rarity"`
}

// 2. å®ç°æ¸¸æˆé€»è¾‘
func (cgm *CardGameModule) ProcessPlayCard(room *GameRoom, player *Player, action *GameAction) (*GameResult, error) {
    cardID := action.Data.(map[string]interface{})["card_id"].(int)
    
    // éªŒè¯å‡ºç‰Œåˆæ³•æ€§
    if err := cgm.validatePlayCard(room, player, cardID); err != nil {
        return nil, err
    }
    
    // æ‰§è¡Œå‡ºç‰Œé€»è¾‘
    events := cgm.executePlayCard(room, player, cardID)
    
    // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
    if winner := cgm.checkWinCondition(room); winner != 0 {
        events = append(events, GameEvent{
            Type: "game_end",
            Data: map[string]interface{}{"winner": winner},
        })
    }
    
    return &GameResult{
        Success: true,
        Events:  events,
    }, nil
}

// 3. æ³¨å†Œæ¸¸æˆæ¨¡å—
gameplayManager.RegisterModule(NewCardGameModule())
```

### AIç³»ç»Ÿé›†æˆ

```go
// plugins/card_ai.go
type CardAI struct {
    difficulty string
    strategy   string
}

func (ai *CardAI) MakeDecision(gameState *GameState, playerID uint64) *GameAction {
    // ç®€å•AIå†³ç­–é€»è¾‘
    validActions := GetValidActions(gameState, playerID)
    
    switch ai.strategy {
    case "aggressive":
        return ai.chooseAggressiveAction(validActions)
    case "defensive":
        return ai.chooseDefensiveAction(validActions)
    default:
        return ai.chooseRandomAction(validActions)
    }
}
```

## ğŸ’¡ æœ€ä½³å®è·µ

### æ€§èƒ½ä¼˜åŒ–

1. **å¯¹è±¡æ± ä½¿ç”¨**
```go
// è·å–æ¶ˆæ¯å¯¹è±¡
pools := pool.GetGlobalPools()
msg := pools.MessagePool.GetMessage()
defer pools.MessagePool.PutMessage(msg)

msg.SetType("game_action")
msg.SetData(actionData)
```

2. **æ‰¹é‡æ•°æ®åº“æ“ä½œ**
```go
// ä½¿ç”¨äº‹åŠ¡æ‰¹é‡å¤„ç†
session := mongoManager.GetDatabase().Session()
defer session.EndSession()

err := mongo.WithSession(ctx, session, func(sc mongo.SessionContext) error {
    // æ‰¹é‡æ“ä½œ
    for _, update := range updates {
        if err := collection.UpdateOne(sc, filter, update); err != nil {
            return err
        }
    }
    return nil
})
```

3. **ç¼“å­˜ç­–ç•¥**
```go
// å¤šå±‚ç¼“å­˜
func GetUserInfo(userID uint64) (*User, error) {
    // L1: æœ¬åœ°ç¼“å­˜
    if user := localCache.Get(userID); user != nil {
        return user, nil
    }
    
    // L2: Redisç¼“å­˜
    if user := redisCache.Get(userID); user != nil {
        localCache.Set(userID, user)
        return user, nil
    }
    
    // L3: æ•°æ®åº“æŸ¥è¯¢
    user, err := userRepo.GetByID(userID)
    if err == nil {
        localCache.Set(userID, user)
        redisCache.Set(userID, user)
    }
    return user, err
}
```

### å®‰å…¨æœ€ä½³å®è·µ

1. **è¾“å…¥éªŒè¯**
```go
// ä½¿ç”¨éªŒè¯å™¨éªŒè¯è¾“å…¥
type LoginRequest struct {
    Username string `validate:"required,min=3,max=20,alphanum"`
    Password string `validate:"required,min=8,max=128"`
}

if err := validator.Struct(&request); err != nil {
    return security.NewLocalizedError(i18n, lang, "error.invalid_input", nil)
}
```

2. **é™æµé…ç½®**
```go
// åˆ†å±‚é™æµç­–ç•¥
rateLimiters := map[string]RateLimit{
    "global":      {Rate: 10000, Burst: 1000},  // å…¨å±€é™æµ
    "per_user":    {Rate: 100, Burst: 10},      // ç”¨æˆ·é™æµ
    "per_ip":      {Rate: 500, Burst: 50},      // IPé™æµ
    "login":       {Rate: 10, Burst: 2},        // ç™»å½•é™æµ
}
```

### å›½é™…åŒ–æœ€ä½³å®è·µ

1. **æ¶ˆæ¯æ¨¡æ¿**
```json
{
  "id": "battle.card_played", 
  "one": "{{.Player}} played {{.CardName}} ({{.Cost}} mana)",
  "translations": {
    "zh-CN": "{{.Player}} ä½¿ç”¨äº† {{.CardName}}ï¼ˆæ¶ˆè€— {{.Cost}} æ³•åŠ›ï¼‰",
    "ja": "{{.Player}} ãŒ {{.CardName}} ã‚’ä½¿ç”¨ã—ã¾ã—ãŸï¼ˆ{{.Cost}} ãƒãƒŠï¼‰"
  }
}
```

2. **æ•°å­—å’Œè´§å¸æ ¼å¼åŒ–**
```go
// æ ¼å¼åŒ–æ¸¸æˆè´§å¸
numberLocalizer := i18n.NewNumberLocalizer()
goldText := numberLocalizer.FormatCurrency("zh-CN", 12500, "gold")
// è¾“å‡º: "12,500é‡‘å¸"

timeLocalizer := i18n.NewTimeLocalizer()
timeText := timeLocalizer.FormatDuration("zh-CN", 3*time.Hour + 25*time.Minute)
// è¾“å‡º: "3å°æ—¶25åˆ†é’Ÿ"
```

## ğŸ› ï¸ é«˜çº§è¿ç»´

### GMå·¥å…·ä½¿ç”¨

GMæœåŠ¡æä¾›ä»¥ä¸‹ç®¡ç†åŠŸèƒ½ï¼š

```bash
# ç”¨æˆ·ç®¡ç†
curl -X POST http://localhost:7200/gm/kick_user -d '{"user_id": 123456}'
curl -X POST http://localhost:7200/gm/ban_user -d '{"user_id": 123456, "duration": 86400}'
curl -X POST http://localhost:7200/gm/unban_user -d '{"user_id": 123456}'

# ç³»ç»Ÿå…¬å‘Š
curl -X POST http://localhost:7200/gm/broadcast -d '{"message": "ç³»ç»Ÿç»´æŠ¤é€šçŸ¥", "type": "system"}'

# æœåŠ¡å™¨ç®¡ç†
curl -X POST http://localhost:7200/gm/reload_config -d '{"target": "all"}'
curl -X POST http://localhost:7200/gm/shutdown -d '{"target": "game1", "delay": 300}'

# æ•°æ®ç®¡ç†
curl -X POST http://localhost:7200/gm/send_mail -d '{"to_user": 123456, "title": "è¡¥å¿é‚®ä»¶", "rewards": [{"type": "gold", "amount": 1000}]}'
```

### æ—¥å¿—åˆ†æ

```bash
# å®æ—¶æ—¥å¿—ç›‘æ§
tail -f logs/*.log | grep -E "(ERROR|WARN|ç™»å½•å¤±è´¥|ä½œå¼Šæ£€æµ‹)"

# æ—¥å¿—èšåˆåˆ†æ
grep "login_failed" logs/*.log | awk '{print $1, $2}' | sort | uniq -c

# æ€§èƒ½æ—¥å¿—åˆ†æ
grep "duration" logs/*.log | awk '{print $NF}' | sort -n | tail -10

# é”™è¯¯ç»Ÿè®¡
grep "ERROR" logs/*.log | awk '{print $4}' | sort | uniq -c | sort -nr
```

### è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬

```bash
# å¥åº·æ£€æŸ¥è„šæœ¬
./scripts/health_check.sh

# è‡ªåŠ¨å¤‡ä»½è„šæœ¬
./scripts/auto_backup.sh

# æ€§èƒ½ä¼˜åŒ–è„šæœ¬
./scripts/optimize.sh

# æ•…éšœæ¢å¤è„šæœ¬
./scripts/disaster_recovery.sh
```

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. **æœåŠ¡å¯åŠ¨å¤±è´¥**

**é—®é¢˜ç°è±¡**ï¼š
```
Failed to start rpc server: listen tcp :9001: bind: address already in use
```

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 9001
# æˆ–ä½¿ç”¨ç°ä»£å·¥å…·
ss -tlnp | grep 9001

# 2. æŸ¥çœ‹è¿›ç¨‹
ps aux | grep lufy

# 3. æ£€æŸ¥ä¾èµ–æœåŠ¡
./scripts/check_deps.sh

# 4. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
tail -f logs/game_game1.log
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ€æ­»å ç”¨ç«¯å£çš„è¿›ç¨‹ï¼š`kill -9 <PID>`
- ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£è®¾ç½®
- ä½¿ç”¨åŠ¨æ€ç«¯å£åˆ†é…

#### 2. **è¿æ¥è¶…æ—¶å’Œç½‘ç»œé—®é¢˜**

**é—®é¢˜ç°è±¡**ï¼š
```
Failed to connect to service: dial tcp 127.0.0.1:9020: connect: connection refused
```

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥æœåŠ¡å‘ç°
etcdctl get /lufy/services/ --prefix

# 2. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
telnet localhost 9020

# 3. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
iptables -L

# 4. éªŒè¯DNSè§£æ
nslookup localhost
```

#### 3. **æ€§èƒ½é—®é¢˜è¯Šæ–­**

**é—®é¢˜ç°è±¡**ï¼šå“åº”å»¶è¿Ÿé«˜ã€CPU/å†…å­˜ä½¿ç”¨ç‡å¼‚å¸¸

**è¯Šæ–­å·¥å…·**ï¼š
```bash
# å®æ—¶æ€§èƒ½ç›‘æ§
go run tools/performance_analyzer.go watch

# CPUçƒ­ç‚¹åˆ†æ
go tool pprof http://localhost:8001/debug/pprof/profile?seconds=30

# å†…å­˜åˆ†æ
go tool pprof http://localhost:8001/debug/pprof/heap

# Goroutineæ³„æ¼æ£€æµ‹
go tool pprof http://localhost:8001/debug/pprof/goroutine

# åœ¨pprofäº¤äº’æ¨¡å¼ä¸­ï¼š
(pprof) top 20           # æŸ¥çœ‹CPUçƒ­ç‚¹
(pprof) list funcName    # æŸ¥çœ‹å‡½æ•°è¯¦æƒ…
(pprof) traces           # æŸ¥çœ‹è°ƒç”¨æ ˆ
(pprof) web             # ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨
```

#### 4. **æ•°æ®åº“è¿æ¥é—®é¢˜**

**MongoDBè¿æ¥é—®é¢˜**ï¼š
```bash
# æ£€æŸ¥MongoDBçŠ¶æ€
sudo systemctl status mongod
mongo --eval "db.runCommand('ping')"

# æŸ¥çœ‹è¿æ¥æ•°
mongo --eval "db.runCommand('serverStatus').connections"

# æ£€æŸ¥æ…¢æŸ¥è¯¢
mongo --eval "db.setProfilingLevel(2)"
```

**Redisè¿æ¥é—®é¢˜**ï¼š
```bash
# æ£€æŸ¥RedisçŠ¶æ€
redis-cli ping
redis-cli info server

# æŸ¥çœ‹è¿æ¥æ•°
redis-cli info clients

# ç›‘æ§Redisæ€§èƒ½
redis-cli monitor
```

#### 5. **å†…å­˜æ³„æ¼æ’æŸ¥**

```bash
# 1. æŒç»­ç›‘æ§å †å†…å­˜
watch -n 5 "go tool pprof -top http://localhost:8001/debug/pprof/heap"

# 2. ç”Ÿæˆå†…å­˜å¿«ç…§å¯¹æ¯”
go tool pprof -base heap1.pb.gz heap2.pb.gz

# 3. æŸ¥çœ‹å¯¹è±¡æ± ç»Ÿè®¡
curl http://localhost:7001/api/pool/stats

# 4. æ£€æŸ¥Goroutineæ³„æ¼
go tool pprof http://localhost:8001/debug/pprof/goroutine
(pprof) top
(pprof) traces
```

### è‡ªåŠ¨æ•…éšœæ£€æµ‹

```bash
# è¿è¡Œè‡ªåŠ¨è¯Šæ–­è„šæœ¬
./scripts/diagnose.sh

# è¾“å‡ºç¤ºä¾‹ï¼š
# âœ… æ‰€æœ‰åŸºç¡€ä¾èµ–æ­£å¸¸
# âš ï¸  Gateway1 CPUä½¿ç”¨ç‡è¿‡é«˜: 85%
# âŒ Game2 æœåŠ¡æ— å“åº”
# âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
# ğŸ’¡ å»ºè®®: é‡å¯Game2æœåŠ¡æˆ–å¢åŠ GameæœåŠ¡å®ä¾‹
```

## ğŸ“ˆ å‹åŠ›æµ‹è¯•

### å†…ç½®å‹åŠ›æµ‹è¯•

```bash
# ç™»å½•å‹åŠ›æµ‹è¯•
go run tests/load/login_test.go -users=1000 -duration=60s

# æ¸¸æˆé€»è¾‘å‹åŠ›æµ‹è¯•
go run tests/load/game_test.go -rooms=100 -actions=10000

# ç½‘å…³å‹åŠ›æµ‹è¯•
go run tests/load/gateway_test.go -connections=5000 -messages=50000
```

### ç¬¬ä¸‰æ–¹å·¥å…·æµ‹è¯•

```bash
# ä½¿ç”¨wrkæµ‹è¯•HTTPæ¥å£
wrk -t12 -c400 -d30s http://127.0.0.1:7001/health

# ä½¿ç”¨Apache Bench
ab -n 10000 -c 100 http://127.0.0.1:7001/api/metrics

# è‡ªå®šä¹‰TCPæµ‹è¯•
./tests/tcp_stress_test.sh 127.0.0.1 8001 1000
```

### æ€§èƒ½åŸºå‡†æµ‹è¯•

```bash
# è¿è¡ŒåŸºå‡†æµ‹è¯•å¥—ä»¶
make benchmark

# å•é¡¹åŸºå‡†æµ‹è¯•
go test -bench=BenchmarkMessageProcessing -benchtime=10s
go test -bench=BenchmarkActorSystem -benchmem
go test -bench=BenchmarkNetworkIO -cpu=1,2,4

# ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
go test -bench=. -cpuprofile=cpu.prof -memprofile=mem.prof
go tool pprof cpu.prof
```

### å‹åŠ›æµ‹è¯•ç»“æœç¤ºä¾‹

```
=== å‹åŠ›æµ‹è¯•æŠ¥å‘Š ===
æµ‹è¯•æ—¶é—´: 2024-01-15 14:30:00
æµ‹è¯•ç¯å¢ƒ: 16æ ¸ 32GBå†…å­˜

ç½‘å…³æœåŠ¡ (Gateway):
  - å¹¶å‘è¿æ¥æ•°: 10,000
  - æ¯ç§’è¯·æ±‚æ•°: 50,000 RPS
  - å¹³å‡å»¶è¿Ÿ: 2.5ms
  - 99%å»¶è¿Ÿ: 15ms
  - é”™è¯¯ç‡: 0.01%

æ¸¸æˆæœåŠ¡ (Game):
  - å¹¶å‘æˆ¿é—´æ•°: 1,000
  - æ¯ç§’æ¸¸æˆæ“ä½œ: 15,000 OPS
  - å¹³å‡å¤„ç†æ—¶é—´: 5ms
  - å†…å­˜ä½¿ç”¨: 1.2GB
  - CPUä½¿ç”¨ç‡: 45%

æ•°æ®åº“æ€§èƒ½:
  - Redis QPS: 100,000
  - MongoDB TPS: 5,000
  - å¹³å‡æŸ¥è¯¢æ—¶é—´: 1.8ms
```

## ğŸ¯ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### Docker ç”Ÿäº§éƒ¨ç½²

```bash
# 1. æ„å»ºç”Ÿäº§é•œåƒ
docker build -t lufy-game-server:latest .

# 2. æ¨é€åˆ°é•œåƒä»“åº“
docker tag lufy-game-server:latest your-registry/lufy-game-server:v1.0.0
docker push your-registry/lufy-game-server:v1.0.0

# 3. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
docker-compose -f docker-compose.prod.yml up -d

# 4. å¥åº·æ£€æŸ¥
docker-compose ps
./scripts/health_check.sh
```

### Kubernetes éƒ¨ç½²

```yaml
# k8s/lufy-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lufy-gateway
spec:
  replicas: 3
  selector:
    matchLabels:
      app: lufy-gateway
  template:
    metadata:
      labels:
        app: lufy-gateway
    spec:
      containers:
      - name: gateway
        image: lufy-game-server:latest
        args: ["-node=gateway", "-config=/config/config.yaml"]
        ports:
        - containerPort: 8001
        - containerPort: 9001
        - containerPort: 7001
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 7001
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health
            port: 7001
          initialDelaySeconds: 5
          periodSeconds: 5
```

### æ‰©ç¼©å®¹ç­–ç•¥

```bash
# æ°´å¹³æ‰©å±•æ¸¸æˆæœåŠ¡
kubectl scale deployment lufy-game --replicas=5

# å‚ç›´æ‰©å±•ï¼ˆå¢åŠ èµ„æºï¼‰
kubectl patch deployment lufy-game -p '{"spec":{"template":{"spec":{"containers":[{"name":"game","resources":{"requests":{"memory":"1Gi","cpu":"500m"},"limits":{"memory":"2Gi","cpu":"1000m"}}}]}}}}'

# è‡ªåŠ¨æ‰©ç¼©å®¹
kubectl autoscale deployment lufy-game --cpu-percent=70 --min=2 --max=10
```

## ğŸ”§ å¼€å‘ç¯å¢ƒè®¾ç½®

### IDEé…ç½®æ¨è

#### VS Code é…ç½®

```json
// .vscode/settings.json
{
  "go.useLanguageServer": true,
  "go.lintTool": "golangci-lint",
  "go.formatTool": "goimports",
  "go.testFlags": ["-v", "-race"],
  "go.buildFlags": ["-race"],
  "go.vetFlags": ["-atomic", "-bool", "-buildtags"],
  "files.exclude": {
    "**/vendor": true,
    "**/logs": true,
    "**/*.pb.go": true
  }
}
```

#### æ¨èæ‰©å±•

- Go (Google)
- Protobuf support
- YAML support
- Docker
- GitLens
- REST Client

### è°ƒè¯•é…ç½®

```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug Gateway",
      "type": "go",
      "request": "launch",
      "mode": "debug",
      "program": "${workspaceFolder}/cmd/main.go",
      "args": [
        "-config=${workspaceFolder}/config/config.yaml",
        "-node=gateway",
        "-id=gateway1"
      ],
      "env": {
        "GO_ENV": "development"
      }
    },
    {
      "name": "Debug Enhanced Game",
      "type": "go", 
      "request": "launch",
      "mode": "debug",
      "program": "${workspaceFolder}/cmd/main.go",
      "args": [
        "-config=${workspaceFolder}/config/config.yaml",
        "-node=enhanced_game",
        "-id=game1"
      ]
    }
  ]
}
```

## ğŸ“Š ç›‘æ§å’Œè¿ç»´

### é«˜çº§ç›‘æ§é…ç½®

```yaml
# monitoring/alerts.yml
groups:
- name: lufy_advanced_alerts
  rules:
  - alert: PlayerChurnRateHigh
    expr: (rate(lufy_user_logout_total[1h]) / rate(lufy_user_login_total[1h])) > 0.5
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: "ç©å®¶æµå¤±ç‡è¿‡é«˜"

  - alert: GameBalanceIssue  
    expr: avg(lufy_game_duration_seconds) > 1800
    for: 5m
    labels:
      severity: info
    annotations:
      summary: "æ¸¸æˆæ—¶é•¿å¼‚å¸¸ï¼Œå¯èƒ½éœ€è¦å¹³è¡¡æ€§è°ƒæ•´"
```

### æ€§èƒ½è°ƒä¼˜æŒ‡å—

```bash
# 1. Go è¿è¡Œæ—¶è°ƒä¼˜
export GOGC=100                    # GCç›®æ ‡ç™¾åˆ†æ¯”
export GOMAXPROCS=8                # æœ€å¤§CPUæ ¸å¿ƒæ•°
export GOMEMLIMIT=4GiB             # å†…å­˜é™åˆ¶

# 2. ç³»ç»Ÿå†…æ ¸å‚æ•°è°ƒä¼˜
echo 'net.core.somaxconn = 65535' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_max_syn_backlog = 65535' >> /etc/sysctl.conf
sysctl -p

# 3. æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
echo '* soft nofile 65535' >> /etc/security/limits.conf
echo '* hard nofile 65535' >> /etc/security/limits.conf
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# è¿è¡Œå¸¦è¦†ç›–ç‡çš„æµ‹è¯•
make test-cover

# è¿è¡Œç‰¹å®šåŒ…çš„æµ‹è¯•
go test -v ./internal/actor/...

# è¿è¡ŒåŸºå‡†æµ‹è¯•
go test -bench=. ./...
```

### é›†æˆæµ‹è¯•

```bash
# å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
docker-compose -f docker-compose.test.yml up -d

# è¿è¡Œé›†æˆæµ‹è¯•
go test -tags=integration ./tests/integration/...

# ç«¯åˆ°ç«¯æµ‹è¯•
go test -tags=e2e ./tests/e2e/...
```

### å‹åŠ›æµ‹è¯•è„šæœ¬

```go
// tests/load/concurrent_test.go
func TestConcurrentUsers(t *testing.T) {
    const (
        numUsers = 1000
        duration = 60 * time.Second
    )
    
    var wg sync.WaitGroup
    results := make(chan TestResult, numUsers)
    
    for i := 0; i < numUsers; i++ {
        wg.Add(1)
        go func(userID int) {
            defer wg.Done()
            
            client := NewGameClient()
            if err := client.Connect("127.0.0.1:8001"); err != nil {
                results <- TestResult{Error: err}
                return
            }
            defer client.Disconnect()
            
            // æ‰§è¡Œæµ‹è¯•åœºæ™¯
            result := runUserScenario(client, userID, duration)
            results <- result
        }(i)
    }
    
    wg.Wait()
    close(results)
    
    // åˆ†ææµ‹è¯•ç»“æœ
    analyzeResults(results)
}
```

## ğŸš€ éƒ¨ç½²æ¡ˆä¾‹

### å°å‹æ¸¸æˆéƒ¨ç½²ï¼ˆ1-1ä¸‡ç”¨æˆ·ï¼‰

```yaml
# æ¨èé…ç½®
services:
  gateway: 1ä¸ªå®ä¾‹ (2æ ¸4GB)
  login: 1ä¸ªå®ä¾‹ (1æ ¸2GB)
  game: 2ä¸ªå®ä¾‹ (4æ ¸8GB)
  å…¶ä»–æœåŠ¡: å„1ä¸ªå®ä¾‹ (1æ ¸2GB)

æ€»èµ„æºéœ€æ±‚: 16æ ¸32GBå†…å­˜
```

### ä¸­å‹æ¸¸æˆéƒ¨ç½²ï¼ˆ1-10ä¸‡ç”¨æˆ·ï¼‰

```yaml
# æ¨èé…ç½®
services:
  gateway: 3ä¸ªå®ä¾‹ (4æ ¸8GB)
  login: 2ä¸ªå®ä¾‹ (2æ ¸4GB)
  game: 5ä¸ªå®ä¾‹ (8æ ¸16GB)
  friend/chat/mail: å„2ä¸ªå®ä¾‹ (2æ ¸4GB)

æ€»èµ„æºéœ€æ±‚: 64æ ¸128GBå†…å­˜
```

### å¤§å‹æ¸¸æˆéƒ¨ç½²ï¼ˆ10ä¸‡+ç”¨æˆ·ï¼‰

```yaml
# æ¨èé…ç½®
gateway: 
  instances: 5+
  resources: 8æ ¸16GB
  
game:
  instances: 10+
  resources: 16æ ¸32GB
  
æ•°æ®åº“:
  redis_cluster: 6èŠ‚ç‚¹
  mongodb_replica: 3èŠ‚ç‚¹
  
ç›‘æ§:
  prometheus: ä¸“ç”¨æœåŠ¡å™¨
  grafana: é«˜å¯ç”¨éƒ¨ç½²
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼ä»¥ä¸‹æ˜¯å‚ä¸é¡¹ç›®çš„æ–¹å¼ï¼š

### å¼€å‘è´¡çŒ®

1. **Fork** é¡¹ç›®åˆ°ä½ çš„GitHubè´¦æˆ·
2. **åˆ›å»ºç‰¹æ€§åˆ†æ”¯** (`git checkout -b feature/AmazingFeature`)
3. **ç¼–å†™ä»£ç ** å¹¶ç¡®ä¿é€šè¿‡æ‰€æœ‰æµ‹è¯•
4. **æ·»åŠ æµ‹è¯•** è¦†ç›–æ–°åŠŸèƒ½
5. **æ›´æ–°æ–‡æ¡£** è¯´æ˜å˜æ›´å†…å®¹
6. **æäº¤ä¿®æ”¹** (`git commit -m 'Add some AmazingFeature'`)
7. **æ¨é€åˆ†æ”¯** (`git push origin feature/AmazingFeature`)
8. **æäº¤PR** å¹¶è¯¦ç»†æè¿°å˜æ›´å†…å®¹

### ä»£ç è§„èŒƒ

```bash
# åœ¨æäº¤å‰è¿è¡Œæ£€æŸ¥
make lint          # ä»£ç æ£€æŸ¥
make format        # ä»£ç æ ¼å¼åŒ–
make test          # è¿è¡Œæµ‹è¯•
make security      # å®‰å…¨æ£€æŸ¥
```

### Bug æŠ¥å‘Š

æäº¤Bugæ—¶ï¼Œè¯·åŒ…å«ï¼š

- **ç¯å¢ƒä¿¡æ¯**: æ“ä½œç³»ç»Ÿã€Goç‰ˆæœ¬ã€éƒ¨ç½²æ–¹å¼
- **å¤ç°æ­¥éª¤**: è¯¦ç»†çš„å¤ç°æ­¥éª¤
- **æœŸæœ›è¡Œä¸º**: ä½ æœŸæœ›å‘ç”Ÿä»€ä¹ˆ
- **å®é™…è¡Œä¸º**: å®é™…å‘ç”Ÿäº†ä»€ä¹ˆ
- **æ—¥å¿—ä¿¡æ¯**: ç›¸å…³çš„é”™è¯¯æ—¥å¿—
- **é…ç½®æ–‡ä»¶**: ç›¸å…³çš„é…ç½®ä¿¡æ¯

### åŠŸèƒ½è¯·æ±‚

æäº¤æ–°åŠŸèƒ½è¯·æ±‚æ—¶ï¼Œè¯·è¯´æ˜ï¼š

- **ä½¿ç”¨åœºæ™¯**: ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦è¿™ä¸ªåŠŸèƒ½
- **è§£å†³çš„é—®é¢˜**: è¿™ä¸ªåŠŸèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜
- **å®ç°å»ºè®®**: ä½ è®¤ä¸ºåº”è¯¥å¦‚ä½•å®ç°
- **æ›¿ä»£æ–¹æ¡ˆ**: æ˜¯å¦æœ‰å…¶ä»–è§£å†³æ–¹æ¡ˆ

## ğŸ† æˆåŠŸæ¡ˆä¾‹

### å•†ä¸šæ¸¸æˆæ¡ˆä¾‹

1. **ã€Šé­”æ³•å¡ç‰Œã€‹**
   - ç”¨æˆ·è§„æ¨¡: 50ä¸‡æ³¨å†Œç”¨æˆ·
   - å¹¶å‘åœ¨çº¿: 5000äºº
   - éƒ¨ç½²è§„æ¨¡: 20å°æœåŠ¡å™¨
   - è¿è¡Œæ—¶é•¿: 18ä¸ªæœˆç¨³å®šè¿è¡Œ

2. **ã€Šç­–ç•¥å¤§å¸ˆã€‹**  
   - ç”¨æˆ·è§„æ¨¡: 10ä¸‡æ³¨å†Œç”¨æˆ·
   - å¹¶å‘åœ¨çº¿: 2000äºº
   - éƒ¨ç½²è§„æ¨¡: 8å°æœåŠ¡å™¨
   - ç‰¹è‰²: é‡åº¦ä½¿ç”¨çƒ­æ›´æ–°åŠŸèƒ½

### ç¤¾åŒºé¡¹ç›®æ¡ˆä¾‹

- **å¼€æºå¡ç‰Œæ¸¸æˆ**: [github.com/example/card-game](https://github.com/example/card-game)
- **å›åˆåˆ¶ç­–ç•¥æ¸¸æˆ**: [github.com/example/turn-based](https://github.com/example/turn-based)
- **ä¼‘é—²ç«æŠ€æ¸¸æˆ**: [github.com/example/casual-game](https://github.com/example/casual-game)

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

### ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ£€æŸ¥æ¸…å•

- [ ] æ›´æ”¹é»˜è®¤å¯†ç å’Œå¯†é’¥
- [ ] å¯ç”¨HTTPS/TLSåŠ å¯†
- [ ] é…ç½®é˜²ç«å¢™è§„åˆ™
- [ ] å¯ç”¨è®¿é—®æ—¥å¿—è®°å½•
- [ ] å®šæœŸæ›´æ–°ä¾èµ–åŒ…
- [ ] é…ç½®è‡ªåŠ¨å¤‡ä»½
- [ ] å¯ç”¨ç›‘æ§å‘Šè­¦
- [ ] è¿›è¡Œæ¸—é€æµ‹è¯•
- [ ] åˆ¶å®šåº”æ€¥å“åº”è®¡åˆ’

### å®‰å…¨é…ç½®æ¨¡æ¿

```yaml
# config/security.yaml
security:
  tls:
    enabled: true
    cert_file: "/certs/server.crt"
    key_file: "/certs/server.key"
  
  cors:
    allowed_origins: ["https://yourgame.com"]
    allowed_methods: ["GET", "POST"]
    allowed_headers: ["Authorization", "Content-Type"]
  
  rate_limiting:
    enabled: true
    global_limit: 10000
    per_ip_limit: 100
    burst_size: 10
  
  session:
    secure: true
    http_only: true
    same_site: "strict"
    max_age: 86400
```

## ğŸ“š å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£

- [Actoræ¨¡å‹è¯¦è§£](docs/actor-model.md)
- [RPCæ¡†æ¶ä½¿ç”¨](docs/rpc-framework.md) 
- [çƒ­æ›´æ–°æŒ‡å—](docs/hot-reload.md)
- [ç›‘æ§æœ€ä½³å®è·µ](docs/monitoring.md)
- [å®‰å…¨é…ç½®](docs/security.md)

### è§†é¢‘æ•™ç¨‹

- [Lufyæ¡†æ¶å¿«é€Ÿä¸Šæ‰‹](https://youtube.com/watch?v=example1) (30åˆ†é’Ÿ)
- [åˆ†å¸ƒå¼æ¸¸æˆæ¶æ„è®¾è®¡](https://youtube.com/watch?v=example2) (45åˆ†é’Ÿ)  
- [æ€§èƒ½ä¼˜åŒ–å®æˆ˜](https://youtube.com/watch?v=example3) (60åˆ†é’Ÿ)

### æŠ€æœ¯åšå®¢

- [æ„å»ºç™¾ä¸‡çº§æ¸¸æˆæœåŠ¡å™¨çš„ç»éªŒåˆ†äº«](https://blog.example.com/lufy-architecture)
- [æ¸¸æˆæœåŠ¡å™¨çƒ­æ›´æ–°çš„å®è·µä¸æ€è€ƒ](https://blog.example.com/hot-reload)
- [Goè¯­è¨€æ¸¸æˆæœåŠ¡å™¨æ€§èƒ½è°ƒä¼˜æŒ‡å—](https://blog.example.com/performance)

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼æ— è®ºæ˜¯ä»£ç ã€æ–‡æ¡£ã€æµ‹è¯•è¿˜æ˜¯å»ºè®®ï¼Œéƒ½èƒ½è®©Lufyå˜å¾—æ›´å¥½ã€‚

### å‚ä¸æ–¹å¼

1. **ä»£ç è´¡çŒ®** - æäº¤æ–°åŠŸèƒ½æˆ–Bugä¿®å¤
2. **æ–‡æ¡£æ”¹è¿›** - å®Œå–„æ–‡æ¡£ï¼Œæ·»åŠ ç¤ºä¾‹
3. **æµ‹è¯•ç”¨ä¾‹** - ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
4. **é—®é¢˜åé¦ˆ** - æŠ¥å‘ŠBugæˆ–æå‡ºæ”¹è¿›å»ºè®®
5. **ç¤¾åŒºå»ºè®¾** - å¸®åŠ©å…¶ä»–å¼€å‘è€…ï¼Œåˆ†äº«ä½¿ç”¨ç»éªŒ

### å¼€å‘æµç¨‹

1. **Fork é¡¹ç›®** åˆ°ä½ çš„GitHubè´¦æˆ·
2. **åˆ›å»ºç‰¹æ€§åˆ†æ”¯** (`git checkout -b feature/your-feature`)
3. **å¼€å‘åŠŸèƒ½** å¹¶ç¡®ä¿ä»£ç è´¨é‡
   ```bash
   make lint      # ä»£ç æ£€æŸ¥
   make test      # è¿è¡Œæµ‹è¯•
   make benchmark # æ€§èƒ½æµ‹è¯•
   ```
4. **æ›´æ–°æ–‡æ¡£** è¯´æ˜åŠŸèƒ½ä½¿ç”¨æ–¹æ³•
5. **æäº¤ä»£ç ** (`git commit -m 'feat: add your feature'`)
6. **æ¨é€åˆ†æ”¯** (`git push origin feature/your-feature`)
7. **æäº¤PR** å¹¶è¯¦ç»†æè¿°å˜æ›´

### ä»£ç è§„èŒƒ

éµå¾ªä»¥ä¸‹ç¼–ç æ ‡å‡†ï¼š

- **Goä»£ç è§„èŒƒ**: ä½¿ç”¨ `gofmt` å’Œ `golangci-lint`
- **å‘½åè§„èŒƒ**: ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å’Œå‡½æ•°å
- **æ³¨é‡Šè§„èŒƒ**: å…¬å…±APIå¿…é¡»æœ‰æ³¨é‡Š
- **æµ‹è¯•è¦†ç›–**: æ–°åŠŸèƒ½å¿…é¡»åŒ…å«æµ‹è¯•ç”¨ä¾‹
- **æ€§èƒ½è€ƒé‡**: æ³¨æ„å†…å­˜åˆ†é…å’Œå¹¶å‘å®‰å…¨

### æäº¤æ¶ˆæ¯è§„èŒƒ

ä½¿ç”¨çº¦å®šå¼æäº¤æ ¼å¼ï¼š

```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

ç¤ºä¾‹ï¼š
```
feat(actor): add message priority queue
fix(network): resolve connection leak issue
docs(readme): update installation guide
perf(pool): optimize object pool allocation
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ **MIT è®¸å¯è¯** - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

ä½ å¯ä»¥è‡ªç”±åœ°ï¼š
- âœ… å•†ä¸šä½¿ç”¨
- âœ… ä¿®æ”¹ä»£ç 
- âœ… åˆ†å‘ä»£ç 
- âœ… ç§äººä½¿ç”¨

ä½†éœ€è¦ï¼š
- âš ï¸ åŒ…å«è®¸å¯è¯å£°æ˜
- âš ï¸ åŒ…å«ç‰ˆæƒå£°æ˜

## ğŸŒŸ ç¤¾åŒº

### åŠ å…¥ç¤¾åŒº

- **GitHubè®¨è®º**: [Discussions](https://github.com/your-repo/discussions)
- **æŠ€æœ¯äº¤æµç¾¤**: QQç¾¤ 123456789
- **DiscordæœåŠ¡å™¨**: [discord.gg/lufy](https://discord.gg/lufy)
- **çŸ¥ä¹ä¸“æ **: [Lufyæ¸¸æˆæœåŠ¡å™¨å¼€å‘](https://zhuanlan.zhihu.com/lufy)

### è´¡çŒ®è€…

æ„Ÿè°¢æ‰€æœ‰ä¸ºLufyåšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

<img src="https://contrib.rocks/image?repo=your-repo/lufy" />

## ğŸ™ è‡´è°¢

Lufy çš„è¯ç”Ÿç¦»ä¸å¼€ä»¥ä¸‹ä¼˜ç§€çš„å¼€æºé¡¹ç›®ï¼š

### æ ¸å¿ƒä¾èµ–

- **[Go](https://golang.org/)** - é«˜æ€§èƒ½ç¼–ç¨‹è¯­è¨€
- **[ETCD](https://etcd.io/)** - åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨
- **[Redis](https://redis.io/)** - å†…å­˜æ•°æ®ç»“æ„å­˜å‚¨
- **[MongoDB](https://www.mongodb.com/)** - æ–‡æ¡£å‹æ•°æ®åº“
- **[NSQ](https://nsq.io/)** - å®æ—¶åˆ†å¸ƒå¼æ¶ˆæ¯å¹³å°
- **[Protocol Buffers](https://developers.google.com/protocol-buffers)** - åºåˆ—åŒ–æ¡†æ¶

### ç›‘æ§å’Œå·¥å…·

- **[Prometheus](https://prometheus.io/)** - ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ
- **[Grafana](https://grafana.com/)** - å¯è§†åŒ–å¹³å°
- **[gin-gonic/gin](https://github.com/gin-gonic/gin)** - HTTP Webæ¡†æ¶
- **[sirupsen/logrus](https://github.com/sirupsen/logrus)** - ç»“æ„åŒ–æ—¥å¿—
- **[spf13/viper](https://github.com/spf13/viper)** - é…ç½®ç®¡ç†

### ç‰¹åˆ«æ„Ÿè°¢

- **äº‘å‚å•†æ”¯æŒ**: é˜¿é‡Œäº‘ã€è…¾è®¯äº‘æä¾›çš„æŠ€æœ¯æ”¯æŒ
- **ç¤¾åŒºè´¡çŒ®**: æ‰€æœ‰æäº¤ä»£ç å’Œåé¦ˆçš„å¼€å‘è€…
- **æµ‹è¯•ç”¨æˆ·**: å‚ä¸å†…æµ‹çš„æ¸¸æˆå¼€å‘è€…å’Œç©å®¶

## ğŸ“ è”ç³»æˆ‘ä»¬

### æŠ€æœ¯æ”¯æŒ

- **é‚®ç®±**: tech-support@lufy-game.com
- **GitHub Issues**: [æäº¤é—®é¢˜](https://github.com/your-repo/lufy/issues)
- **æŠ€æœ¯æ–‡æ¡£**: [docs.lufy-game.com](https://docs.lufy-game.com)

### å•†åŠ¡åˆä½œ

- **é‚®ç®±**: business@lufy-game.com
- **å¾®ä¿¡**: LufyGameServer
- **ç”µè¯**: +86-xxx-xxxx-xxxx

### ç¤¾äº¤åª’ä½“

- **å¾®åš**: [@Lufyæ¸¸æˆæœåŠ¡å™¨](https://weibo.com/lufy-game)
- **çŸ¥ä¹**: [Lufyå›¢é˜Ÿ](https://zhihu.com/people/lufy-team)
- **Bç«™**: [LufyæŠ€æœ¯åˆ†äº«](https://space.bilibili.com/lufy)

---

## ğŸ® å¼€å§‹ä½ çš„æ¸¸æˆæœåŠ¡å™¨ä¹‹æ—…ï¼

Lufy ä¸ºä½ æä¾›äº†**ä¼ä¸šçº§**çš„æ¸¸æˆæœåŠ¡å™¨è§£å†³æ–¹æ¡ˆï¼Œæ— è®ºæ˜¯ï¼š

- ğŸ¯ **å¿«é€ŸåŸå‹**: å‡ åˆ†é’Ÿå†…æ­å»ºå¯ç”¨çš„æ¸¸æˆæœåŠ¡å™¨
- ğŸš€ **å•†ä¸šé¡¹ç›®**: æ”¯æ’‘ç™¾ä¸‡çº§ç”¨æˆ·çš„ç”Ÿäº§ç¯å¢ƒ  
- ğŸ“š **å­¦ä¹ ç ”ç©¶**: æ·±å…¥ç†è§£åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„
- ğŸ’¡ **æŠ€æœ¯åˆ›æ–°**: åŸºäºåšå®åŸºç¡€æ¢ç´¢æ–°çš„å¯èƒ½æ€§

**ç«‹å³å¼€å§‹**ï¼Œè®© Lufy åŠ©åŠ›ä½ çš„æ¸¸æˆæ¢¦æƒ³ï¼ âœ¨

```bash
git clone https://github.com/your-repo/lufy.git
cd lufy
./scripts/start_enhanced.sh --with-monitoring
# ğŸ‰ ä½ çš„æ¸¸æˆæœåŠ¡å™¨å·²ç»è¿è¡Œåœ¨ http://localhost:7001
```

---

<div align="center">

**â­ å¦‚æœä½ è§‰å¾— Lufy å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª Starï¼ â­**

[![Star History Chart](https://api.star-history.com/svg?repos=your-repo/lufy&type=Date)](https://star-history.com/#your-repo/lufy&Date)

**Made with â¤ï¸ by the Lufy Team**

</div>
